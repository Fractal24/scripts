#!/usr/bin/env ruby

require 'rubygems'
require 'trollop'
require 'csv'

ARGV.push("--help") if ARGV.empty?
opts = Trollop::options do
  banner File.basename($0)
  opt :input, "csv files", :required=>true, :type=>:strings
end

lines = Hash.new
headers = nil
CSV.foreach(opts.input[0], :headers => true) do |line|
  headers = line.headers if !headers
  rowName = line[headers.first]
  lines[rowName] = line.fields if rowName
end

lines2 = Hash.new
headers2 = nil
CSV.foreach(opts.input[1], :headers => true) do |line|
  headers2 = line.headers if !headers2
  rowName = line[headers2.first]
  if lines[rowName]
    lines[rowName] += line.fields
  end
end

print (headers + headers2).to_csv
lines.keys.each do |key|
  print lines[key].to_csv
end
